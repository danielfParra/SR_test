{% extends "global/Base.html" %}

{% block content %}

<div style="display: flex; margin: 0;">
    <!-- Left Pane -->
    <div class="left-pane" style="width: 50%; background-color: #f8f9fa; padding: 20px; box-sizing: border-box; overflow-y: auto; border-right: 1px solid #ddd;">
        
        {{ include Constants.SenderReminder }}

    </div>

    <!-- Right Pane -->
    <div class="right-pane" style="width: 50%; background-color: #fff; padding: 20px; box-sizing: border-box; overflow-y: auto;">
        <h3 data-intro="N√∫mero de ronda" data-step="3">Ronda X: Env√≠a un Mensaje al Jugador B</h3>

        <p>Eres el Jugador A. Tu tarea es enviar un mensaje al Jugador B.</p>

        <p>
            <label for="id_sender_choice" style="font-size: 20px;">
                Elige un n√∫mero para enviar como tu mensaje al Jugador B.
            </label>
            <p data-intro="Elige tu n√∫mero" data-step="5">
            <select name="sender_choice" id="sender_choice" class="form-select form-select-lg" oninput="valueInput(this.value)">
                <option value="" selected>Elige aqu√≠</option>
                {{ if player.participant.treatment != "Babbling" }}
                <option value="8">ü§ñ Enviar n√∫mero secreto verdadero (v√≠a Computador)</option>
                {{ endif }}
                <option value="1">1Ô∏è‚É£</option>
                <option value="2">2Ô∏è‚É£</option>
                <option value="3">3Ô∏è‚É£</option>
                <option value="4">4Ô∏è‚É£</option>
                <option value="5">5Ô∏è‚É£</option>
                <option value="6">6Ô∏è‚É£</option>
                <option value="7">7Ô∏è‚É£</option>
            </select>
        </p>
        </p>

        <div id="confirm_button" class="hidden-paragraph">
            <div id="message-box">
                <p>
                    <span id="pre_message"></span>
                </p>
                <div class="d-flex justify-content-center">
                    <div class="card text-dark bg-light mb-3" style="width: 24rem;">
                        <div class="card-body text-center">
                            <p class="card-text">Para recibir la mayor ganancia, deber√≠as elegir <b><span id="message"></span></b>.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-grid gap-2 col-6 mx-auto" data-intro="Bot√≥n de Env√≠o" data-step="7">
                <button type="submit" class="btn btn-success btn-lg btn-block">Enviar</button>
            </div>
        </div>
    </div>
</div>

<!-- Intro.js Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/5.0.0/intro.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/5.0.0/introjs.min.css" />

<script>
    let tourStarted = false; // Asegura que el tour solo se ejecute una vez
    var intro = introJs();

    intro.setOptions({
            steps: [
                {   title: 'Tutorial',
                    intro: "Esta es tu pantalla de decisi√≥n. Permanecer√° constante para todas las rondas del juego. Presiona 'Siguiente' para una visi√≥n general."},
                {   title: 'Resumen del juego',
                    element: '.left-pane', intro: 'Esta parte de la pantalla te ayuda a recordar la configuraci√≥n del juego. Todos los jugadores ver√°n un recordatorio similar mientras juegan.' },
                {   title: 'N√∫mero de ronda',
                    element: 'h3', intro: 'Aqu√≠ puedes ver en qu√© ronda est√°s. En el experimento, \'X\' variar√° entre 1-30.' },
                {   title: 'Eligiendo un mensaje',
                    element: '#sender_choice', intro: 'Seleccionas tu mensaje eligiendo una de las opciones del men√∫ desplegable.<br> Por favor elige cualquier opci√≥n ahora como prueba.' },
                {   title: 'Tu mensaje al Jugador B',
                    element: '#message-box', intro: 'El Jugador B ver√° este mensaje antes de hacer una suposici√≥n.' },
                {
                    title: 'L√≠mite de tiempo',
                    element: 'h3',
                    intro: 'En el experimento, tendr√°s un l√≠mite de tiempo para tomar tu decisi√≥n. Ver√°s tu tiempo restante en una cuenta regresiva en la parte superior de la p√°gina. <br> Para este tutorial, no hay l√≠mite de tiempo.'
                },
                {   title: 'Bot√≥n de env√≠o',
                    element: '.btn-success', intro: 'Haz clic aqu√≠ para proceder a la siguiente p√°gina. Puedes proceder ahora o cerrar este tutorial para familiarizarte m√°s con la pantalla. ¬°Presiona "Enviar" cuando est√©s listo!' }
            ],
            showStepNumbers: true,
            nextLabel: 'Siguiente',
            prevLabel: 'Atr√°s',
            doneLabel: 'Cerrar',
            exitOnOverlayClick: false,
            exitOnEsc: false, // Evita salir del tour prematuramente
            keyboardNavigation: false,
        });

    window.onload = function() {
    if (!tourStarted) {
        tourStarted = true;
        intro.start();
        }
    };

    let first_round = 1;
    function Disablefirst_round() {
        first_round = 0;
    }

    // Deshabilitar el bot√≥n siguiente cuando el usuario debe interactuar primero con la pantalla de decisi√≥n.
    intro.onafterchange(function(targetElement) {  
    if(intro._currentStep == 3) { 
        var original_onclick = $('.introjs-nextbutton').get(0).onclick;
        $('.introjs-nextbutton').addClass('introjs-disabled');
        $('.introjs-nextbutton').get(0).onclick = null;
    }
    });

    function valueInput (input_answer) {
        const confirmButton = document.getElementById('confirm_button');
        const messageSpan = document.getElementById('message');
        const preMessageSpan = document.getElementById('pre_message');

        if (parseFloat(input_answer) >= 1 && parseFloat(input_answer) <= 7) {
            preMessageSpan.innerHTML = "Basado en tu elecci√≥n, el Jugador B recibir√° el siguiente mensaje:";
            messageSpan.innerHTML = input_answer;
            show_text(confirmButton);

            if (first_round == 1) {
                intro.exit();
                intro.goToStep(5);
                Disablefirst_round();
            }
            
        } else if (parseFloat(input_answer) === 8) {
            preMessageSpan.innerHTML = "Basado en tu elecci√≥n, la computadora reemplazar√° la \"X\" a continuaci√≥n con el verdadero n√∫mero secreto:";
            messageSpan.innerHTML = "X";
            show_text(confirmButton);
            
            if (first_round == 1) {
                intro.exit();
                intro.goToStep(5);
                Disablefirst_round();
            }

        }{{player.round_number}}
    }

    function hide_text (element) {
        element.classList.add('hidden-paragraph');
    }

    // Validaci√≥n del Bot√≥n de Env√≠o
    document.querySelector('.btn-success').addEventListener('click', function(event) {
        const selectedValue = document.getElementById('sender_message').value;
        if (!selectedValue) {
            event.preventDefault();
            const errorDiv = document.createElement('div');
            errorDiv.style.color = 'red';
            errorDiv.style.marginTop = '10px';
            errorDiv.style.fontWeight = 'bold';
            errorDiv.innerText = '¬°Por favor ingresa tu n√∫mero antes de continuar!';
            const parentDiv = document.querySelector('.right-pane');
            if (!parentDiv.querySelector('.error-message')) {
                errorDiv.classList.add('error-message');
                parentDiv.appendChild(errorDiv);
            }
        }
    });

    function show_text (element) {
        element.classList.remove('hidden-paragraph');
    }

    function hide_text (element) {
        element.classList.add('hidden-paragraph');
    }
</script>
{% endblock %}

{% block styles %}
<style>
/* Ocultar el bot√≥n de cerrar del tour de introducci√≥n. 
    Esto obliga a todos a tomar el tutorial.
*/
.introjs-skipbutton{
    visibility: hidden !important;
}




</style>

<!-- Cargar los estilos CSS personalizados -->
<link rel="stylesheet" href="{% static 'global/myStyle.css' %}">
<link rel="stylesheet" href="{% static 'global/myStyleButton.css' %}">

{% endblock %}